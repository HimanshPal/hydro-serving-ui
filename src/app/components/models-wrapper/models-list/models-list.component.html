<div class='models-list'>
  <table *ngIf="id == 'all'" class='models-list-table mdl-data-table mdl-js-data-table mdl-shadow--2dp'>
    <thead>
    <tr>
      <th>Id</th>
      <th>Name</th>
      <th>Version</th>
      <th>Model Type</th>
      <th>Runtime Type</th>
      <th>Deploy status</th>
      <th>actions</th>
    </tr>
    </thead>
    <tbody >
    <ng-template ngFor let-model [ngForOf]="models | sortBy: 'id'">
      <tr class='models-list-table__tr cs-cursor-pointer'>
        <td class="models-list-table__td id"><div title="{{model.id}}" class='cs-text-overflow-ellipsis'>{{model.id}}</div></td>
        <td class="models-list-table__td name"><div title="{{model.source}}" class='cs-text-overflow-ellipsis'>{{model.source}}</div></td>
        <td class="models-list-table__td version">{{model.lastModelRuntime.modelVersion}}</td>
        <td class="models-list-table__td model-type" title="{{model.lastModelRuntime.runtimeType ? model.lastModelRuntime.runtimeType.tags : ''}}">
          {{model.lastModelRuntime.runtimeType ? model.lastModelRuntime.runtimeType.tags : ''}}
        </td>
        <td class="models-list-table__td run-type"><div title="{{model.runtimeType.name}}" class='cs-text-overflow-ellipsis'>{{model.runtimeType.name}}</div></td>
        <td class="models-list-table__td status">
          <div title="{{model | modelStatus}}" class='cs-text-overflow-ellipsis'>
            <strong><span [ngClass]="{
              'mdl-color-text--green-700': (model | modelStatus) == 'DEPLOYED',
              'mdl-color-text--red-700': (model | modelStatus) == 'FAILED',
              'mdl-color-text--grey-900': (model | modelStatus) == 'STOPPED'
              }">{{model | modelStatus}}</span></strong>
            {{(model.lastModelBuild.finished ? model.lastModelBuild.finished : model.created) | utcToLocal | amTimeAgo}}
          </div>
        </td>
        <td class='cs-text-overflow-ellipsis models-list-table__td'>
          <div fxLayout="row" fxLayoutAlign="space-between center"  class="models-list-table__td__actions">
            <div class="models-list-table__td__actions--buttons">
              <a title="{{(model | modelStatus) == 'DEPLOYED' ? 'Redeploy' : 'Deploy'}}" (click)="buildModel(model)" class="hydro-link mdl-color-text--grey-700">
                <mdl-icon>cloud_upload</mdl-icon>
              </a>
              <a *ngIf="(model | modelStatus) == 'DEPLOYED'" class="hydro-link mdl-color-text--grey-700" (click)="stopModel(model.id)" title="Stop">
                <mdl-icon>delete_forever</mdl-icon>
              </a>
              <a *ngIf="(model | modelStatus) == 'DEPLOYED'" (click)="testModel(model)" title='Test' class="hydro-link mdl-color-text--blue-800">
                <mdl-icon>play_circle_outline</mdl-icon>
              </a>
          </div>
          </div>
        </td>
      </tr>
    </ng-template>
    </tbody>
  </table>

  <table *ngIf="id != 'all'" class='models-list-table mdl-data-table mdl-js-data-table mdl-shadow--2dp'>
    <thead>
    <tr>
      <th>Id</th>
      <th>Service Name</th>
      <th>Model Name</th>
      <th>Version</th>
      <th>actions</th>
    </tr>
  </thead>

  <tbody >
  <ng-template ngFor let-service let-i="index" [ngForOf]="weightedServices">
    <ng-template ngFor let-weight let-j="index" [ngForOf]="service.weights">
      <ng-template ngFor let-modelService let-k="index" [ngForOf]="modelServices">
        <tr *ngIf="service.id == id && modelService.serviceId == weight.serviceId" class='models-list-table__tr cs-cursor-pointer'>
          <td class="models-list-table__td id"><div title="{{modelService.serviceId}}" class='cs-text-overflow-ellipsis'>{{modelService.serviceId}}</div></td>
          <td class="models-list-table__td name">
            <div title="{{modelService.serviceName}}" class='cs-text-overflow-ellipsis'>{{modelService.serviceName}}</div>
          </td>
          <td>{{modelService.modelRuntime.source}}</td>
          <td class="models-list-table__td version">{{modelService.modelRuntime.modelVersion}}</td>
          <td class='cs-text-overflow-ellipsis models-list-table__td'>
            <mdl-icon [ngClass]="{'cs-visible': activeService == service.serviceName}"
                      title="Edit service" (click)="openDialogTestWeightedServicesForm(modelService)">
              play_circle_outline
            </mdl-icon>
            <mdl-icon hidden [ngClass]="{'cs-visible': activeService == service.serviceName}"
                      title="Edit service" (click)="openDialogWeightedServicesForm(service)">
              settings
            </mdl-icon>
            <a class="hydro-link mdl-color-text--grey-700" (click)="deleteWeightedService(service.id)" title="Delete">
              <mdl-icon>delete_forever</mdl-icon>
            </a>

          </td>
        </tr>
      </ng-template>
    </ng-template>
  </ng-template>
  </tbody>

  </table>
</div>
